# 多人社区案例

## 示例

![image-20200524154855012](第六天笔记.assets/image-20200524154855012.png)





## path模块

之前开放静态资源有过：

~~~javascript
app.use('/node_module/',express.static(path.join(_dirname,'./node_modules/')))
~~~



+ path.basename
  + 获取一个路径的文件名（默认包含扩展名）
+ path.dirname
  + 获取一个路径中的目录部分
+ path.extname
  + 获取一个路径中的扩展名部分
+ path.parse
  + 把一个路径转为对象
    + root：根目录
    + dir目录
    + base包含后缀名的文件名
    + ext后缀名
    + name不包含后缀名的文件名
+ path.join
  + 当你需要进行路由拼接的时候，推荐使用这个方法
+ path.isAbsolute
  + 判断一个路径是否是绝对路径

![image-20200524160736002](第六天笔记.assets/image-20200524160736002.png)



![image-20200524160852499](第六天笔记.assets/image-20200524160852499.png)





![image-20200524161010707](第六天笔记.assets/image-20200524161010707.png)





![image-20200524161258222](第六天笔记.assets/image-20200524161258222.png)



## dirname和filename

在每个模块中，除了`require`,`exports`等模块相关的API之外，还有两个特殊的成员：

+ `__dirname`  **动态获取** 可以用来获取当前文件模块所属目录的绝对路径.
+ `__filename` **动态获取** 可以用来获取获取当前文件的绝对路径。
+ `__dirname`和`__filename` 是不受执行node命令所属路径影响的

在文件操作中，使用相对路径是不可靠的，因为在Node中文件操作的路径被设计为相对于执行Node命令所处的路径（不是bug, 人家这样设计是有使用场景的）。

所以为了解决这个问题，很简单，只需要把相对路径变成绝对路径就可以了

那这里我们就使用__dirname或者\____filename来帮助我们解决这个问题

在拼接路径的过程中，为了避免手动拼接带来的一些低级的错误，所以推荐多使用：path.join()来辅助拼接。

所以为了尽量避免刚才所描述的这个问题，大家以后在操作文件中使用的相对路径都统一替换成**`动态的绝对路径`**

> 补充：模块中的路径标识和这里的路径没有关系，不受影响
>
> 模块中的路径标识和文件操作中的相对路径标识不一致
>
> 模块中的路径标识就是相对于当前文件模块，不受执行node命令所处路径影响。



![image-20200524163219814](第六天笔记.assets/image-20200524163219814.png)



![image-20200524174622550](第六天笔记.assets/image-20200524174622550.png)

![image-20200524174058304](第六天笔记.assets/image-20200524174058304.png)





![image-20200524174301710](第六天笔记.assets/image-20200524174301710.png)





![image-20200524175108093](第六天笔记.assets/image-20200524175108093.png)





![image-20200524175450364](第六天笔记.assets/image-20200524175450364.png)

## art-template中的include-extend-block语法



### 修改views目录

![image-20200524233349469](第六天笔记.assets/image-20200524233349469.png)



### 子模版

![image-20200524233814013](第六天笔记.assets/image-20200524233814013.png)



![image-20200524233939558](第六天笔记.assets/image-20200524233939558.png)



### 模板继承

![image-20200524234230042](第六天笔记.assets/image-20200524234230042.png)





![image-20200524234410857](第六天笔记.assets/image-20200524234410857.png)







![image-20200524234601450](第六天笔记.assets/image-20200524234601450.png)





![image-20200524234705112](第六天笔记.assets/image-20200524234705112.png)





![image-20200524234939134](第六天笔记.assets/image-20200524234939134.png)



![image-20200524235116366](第六天笔记.assets/image-20200524235116366.png)







![image-20200524235203718](第六天笔记.assets/image-20200524235203718.png)





## 案例中的资源页面





## 设计注册登录退出的路由

![image-20200525000234667](第六天笔记.assets/image-20200525000234667.png)



## 配置注册登录的路由

![image-20200525000624861](第六天笔记.assets/image-20200525000624861.png)



## 处理注册页面-配置body-parser

![image-20200525001508876](第六天笔记.assets/image-20200525001508876.png)





## 设计用户数据模型



![image-20200525001919765](第六天笔记.assets/image-20200525001919765.png)





![image-20200525002404396](第六天笔记.assets/image-20200525002404396.png)



![image-20200525002515641](第六天笔记.assets/image-20200525002515641.png)







![image-20200525002629218](第六天笔记.assets/image-20200525002629218.png)







![image-20200525002745783](第六天笔记.assets/image-20200525002745783.png)





![image-20200525002947872](第六天笔记.assets/image-20200525002947872.png)





![image-20200525003148231](第六天笔记.assets/image-20200525003148231.png)







## 处理注册请求



![image-20200525093315192](第六天笔记.assets/image-20200525093315192.png)





### 或查询

可以在菜鸟教程中查找mongodb的更进一步的查询条件

![image-20200525093907186](第六天笔记.assets/image-20200525093907186.png)





![image-20200525094056838](第六天笔记.assets/image-20200525094056838.png)





![image-20200525094241680](第六天笔记.assets/image-20200525094241680.png)





### express中的json方法



![image-20200525094836778](第六天笔记.assets/image-20200525094836778.png)





![image-20200525095127064](第六天笔记.assets/image-20200525095127064.png)





![image-20200525095411798](第六天笔记.assets/image-20200525095411798.png)





![image-20200525095619072](第六天笔记.assets/image-20200525095619072.png)





### Node中的MD5加密

![image-20200525095836232](第六天笔记.assets/image-20200525095836232.png)





![image-20200525100027519](第六天笔记.assets/image-20200525100027519.png)





![image-20200525100155142](第六天笔记.assets/image-20200525100155142.png)







![image-20200525100245869](第六天笔记.assets/image-20200525100245869.png)







## 表单同步提交和异步提交







![image-20200525102751935](第六天笔记.assets/image-20200525102751935.png)



![image-20200525103244688](第六天笔记.assets/image-20200525103244688.png)





## 服务端重定向对异步请求无效



![image-20200525103946343](第六天笔记.assets/image-20200525103946343.png)





![image-20200525104037489](第六天笔记.assets/image-20200525104037489.png)







## 通过session保存登录状态



![image-20200525104925114](第六天笔记.assets/image-20200525104925114.png)



### express-session

![image-20200525105614816](第六天笔记.assets/image-20200525105614816.png)



![image-20200525105730741](第六天笔记.assets/image-20200525105730741.png)



### app.js中配置express-session

![image-20200525105948484](第六天笔记.assets/image-20200525105948484.png)





### router.js使用express-session

![image-20200525110055033](第六天笔记.assets/image-20200525110055033.png)







![image-20200525110716205](第六天笔记.assets/image-20200525110716205.png)





![image-20200525110843005](第六天笔记.assets/image-20200525110843005.png)





![image-20200525111235413](第六天笔记.assets/image-20200525111235413.png)





![image-20200525141919064](第六天笔记.assets/image-20200525141919064.png)





![image-20200525142010554](第六天笔记.assets/image-20200525142010554.png)





## 处理完成登录功能



![image-20200525143112344](第六天笔记.assets/image-20200525143112344.png)





![image-20200525143219982](第六天笔记.assets/image-20200525143219982.png)





## 处理完成用户退出



![image-20200525143425090](第六天笔记.assets/image-20200525143425090.png)





![image-20200525143530635](第六天笔记.assets/image-20200525143530635.png)







## 中间件概念



![image-20200525154602581](第六天笔记.assets/image-20200525154602581.png)





## Express中的中间件



![image-20200525155353530](第六天笔记.assets/image-20200525155353530.png)





![image-20200525155508674](第六天笔记.assets/image-20200525155508674.png)





![image-20200525155751471](第六天笔记.assets/image-20200525155751471.png)





![image-20200525160127660](第六天笔记.assets/image-20200525160127660.png)





![image-20200525160734021](第六天笔记.assets/image-20200525160734021.png)









![image-20200525161236676](第六天笔记.assets/image-20200525161236676.png)





![image-20200525161634198](第六天笔记.assets/image-20200525161634198.png)



## 配置中间件



![image-20200525162231982](第六天笔记.assets/image-20200525162231982.png)





![image-20200525162300119](第六天笔记.assets/image-20200525162300119.png)





![image-20200525162652019](第六天笔记.assets/image-20200525162652019.png)





![image-20200525163323955](第六天笔记.assets/image-20200525163323955.png)





![image-20200525164037550](第六天笔记.assets/image-20200525164037550.png)







![image-20200525164112323](第六天笔记.assets/image-20200525164112323.png)





![image-20200525164243079](第六天笔记.assets/image-20200525164243079.png)





![image-20200525171840770](第六天笔记.assets/image-20200525171840770.png)





![image-20200525171940377](第六天笔记.assets/image-20200525171940377.png)





