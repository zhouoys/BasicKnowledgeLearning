# 笔记

## 1. ECMAScript 和 JavaScript的关系

1. ECMAScript 是 JavaScript 的规格
2. JavaScript 是 ECMAScript 的一种实现另外的 ECMAScript 方言还有 JScript 和 ActionScript）

## 2. ES6 和 ECMAScript 2015的关系

​		ES6 既是一个历史名词，也是一个泛指，<font color="red">含义是 5.1 版以后的 JavaScript 的下一代标准，涵盖了 ES2015、ES2016、ES2017 等等</font>，而 ES2015 则是正式名称，特指该年发布的正式版本的语言标准。本书中提到 ES6 的地方，一般是指 ES2015 标准，但有时也是泛指“下一代 JavaScript 语言

> 目前，各大浏览器对 ES6 的支持可以查看[kangax.github.io/compat-table/es6/](https://kangax.github.io/compat-table/es6/)。
>
> Node.js 是 JavaScript 的服务器运行环境（runtime）。它对 ES6 的支持度更高。除了那些默认打开的功能，还有一些语法功能已经实现了，但是默认没有打开。使用下面的命令，可以查看 Node.js 默认没有打开的 ES6 实验性语法

~~~shell
// Linux & Mac
$ node --v8-options | grep harmony

// Windows
$ node --v8-options | findstr harmony
~~~



## 3. [Babe](https://babeljs.io/) 转换器 

> [Babel](https://babeljs.io/) 是一个广泛使用的 ES6 转码器，可以将 ES6 代码转为 ES5 代码，从而在老版本的浏览器执行。这意味着，你可以用 ES6 的方式编写程序，又不用担心现有环境是否支持。下面是一个例子。

### 3.1 Babel的安装

~~~shell
$ npm install --save-dev @babel/core
~~~

**补充知识点**

`npm install` 在安装 `npm `包时，有两种命令参数可以把它们的信息写入 `package.json` 文件
一个是

```shell
 --save || -S // 运行依赖（发布）
1
```

另一个是

```shell
–save-dev || -D //开发依赖（辅助）
1
```

区别是它们会把依赖包添加到package.json 文件

`–save ： dependencies `键下，发布后还需要依赖的模块，譬如像jQuery库或者Angular框架类似的，我们在开发完后后肯定还要依赖它们，否则就运行不了。

`–save-dev ： devDependencies `键下，开发时的依赖比如安装 js的压缩包gulp-uglify 因为我们在发布后用不到它，而只是在我们开发才用到它。

譬如：

```json
{
 "dependencies": {
    "vue": "^2.2.1"
  },
  "devDependencies": {
    "babel-core": "^6.0.0",
    "webpack": "^2.2.0",
  }
}
```



### 3.2 配置文件.babelrc

> <font color="red">Babel 的配置文件是`.babelrc`，存放在项目的根目录下</font>。使用 Babel 的第一步，就是配置这个文件。

**作用**

~~~json
该文件用来设置转码规则和插件，基本格式如下。
{
  "presets": [],
  "plugins": []
}

~~~

`presets` 字段设定转码规则，官方提供以下的规则集，你可以根据需要安装。

~~~shell
# 最新转码规则
$ npm install --save-dev @babel/preset-env

# react 转码规则
$ npm install --save-dev @babel/preset-react
~~~

然后，将这些规则加入`.babelrc`。

~~~json
  {
    "presets": [
      "@babel/env",
      "@babel/preset-react"
    ],
    "plugins": []
  }
~~~

注意，以下所有 Babel 工具和模块的使用，都必须先写好 `.babelrc`。



### 3.3 命令行转码

> Babel 提供命令行工具`@babel/cli`，用于命令行转码。

安装命令

~~~shell
$ npm install --save-dev @babel/cli
~~~

基本用法如下

~~~shell
# 转码结果输出到标准输出
$ npx babel example.js

# 转码结果写入一个文件
# --out-file 或 -o 参数指定输出文件
$ npx babel example.js --out-file compiled.js
# 或者
$ npx babel example.js -o compiled.js

# 整个目录转码
# --out-dir 或 -d 参数指定输出目录
$ npx babel src --out-dir lib
# 或者
$ npx babel src -d lib

# -s 参数生成source map文件
$ npx babel src -d lib -s
~~~



### 3.4 babel-node

> `@babel/node`模块的`babel-node`命令，提供一个支持 ES6 的 REPL 环境。它支持 Node 的 REPL 环境的所有功能，而且可以直接运行 ES6 代码。

安装这个模块

~~~shell
$ npm install --save-dev @babel/node
~~~

执行`babel-node`就进入 REPL 环境。

~~~shell
$ npx babel-node
> (x => x * 2)(1)
2
~~~

`babel-node`命令可以直接运行 ES6 脚本。将上面的代码放入脚本文件`es6.js`，然后直接运行。

~~~shell
# es6.js 的代码
# console.log((x => x * 2)(1));
$ npx babel-node es6.js
2
~~~



### 3.5 babel/register 模块

> `@babel/register`模块改写`require`命令，为它加上一个钩子。此后，每当使用`require`加载`.js`、`.jsx`、`.es`和`.es6`后缀名的文件，就会先用 Babel 进行转码。

安装

~~~shell
$ npm install --save-dev @babel/register
~~~

使用时，必须首先加载`@babel/register`。

```javascript
// index.js
require('@babel/register');
require('./es6.js');
```

然后，就不需要手动对`index.js`转码了。

~~~javascript
$ node index.js
2
~~~

需要注意的是，`@babel/register`只会对`require`命令加载的文件转码，而不会对当前文件转码。另外，由于它是实时转码，所以只适合在开发环境使用。



**以下为参考**

### 3.6 polyfill

Babel 默认只转换新的 JavaScript 句法（syntax），而不转换新的 API，比如`Iterator`、`Generator`、`Set`、`Map`、`Proxy`、`Reflect`、`Symbol`、`Promise`等全局对象，以及一些定义在全局对象上的方法（比如`Object.assign`）都不会转码。

举例来说，ES6 在`Array`对象上新增了`Array.from`方法。Babel 就不会转码这个方法。如果想让这个方法运行，可以使用`core-js`和`regenerator-runtime`(后者提供generator函数的转码)，为当前环境提供一个垫片。

安装命令如下。

~~~she
$ npm install --save-dev core-js regenerator-runtime
~~~

然后，在脚本头部，加入如下两行代码。

~~~java
import 'core-js';
import 'regenerator-runtime/runtime';
// 或者
require('core-js');
require('regenerator-runtime/runtime);
~~~

Babel 默认不转码的 API 非常多，详细清单可以查看`babel-plugin-transform-runtime`模块的[definitions.js](https://github.com/babel/babel/blob/master/packages/babel-plugin-transform-runtime/src/runtime-corejs3-definitions.js)文件。

### 3.7 浏览器环境（略）

Babel 提供一个[REPL 在线编译器](https://babeljs.io/repl/)，可以在线将 ES6 代码转为 ES5 代码。转换后的代码，可以直接作为 ES5 代码插入网页运行。