# 事件原理笔记

+ 必须要加分号

代码

~~~javascript
document.body.appendChild(el);
el.style.display = 'none';
// 按钮回闪动一下，应该修改为，这样显示效果更好
el.style.display = 'none';
document.body.appendChild(el);

~~~

// 竞争条件

// 事件环 事件循环



网页==》主线程（大量事情，是Javascript发生的地方。这是渲染发生的地方，是DOM存在的地方）==》意味着网页上大部分的活动都具有确定性的顺序。也就是不会有多段javascript代码同时运行去修改同一个DOM，让你处于一个可怕的竞争条件的世界。

也意味着，如果主线程上的任务需要很长时间，例如200毫秒，用户会注意到，因为它阻止了加载，渲染和交互。

虽然我们有主线程，但是还是需要要其他线程用来网络请求，编码和解码，加密，监控输入设备，一旦这些线程有了需要页面响应的操作，他们需要通知主线程。这里是时间环（事件循环）来协调所有的这些活动。

分析setTimeout(callback,ms)是如何工作的？

~~~javascript
  setTimeout方法，在调用时
  运行如下步骤:
  等待指定时间
  触发回调函数
  完成
~~~

但是以上的分析是不准确的，因为setTimeout方法和回调函数运行在同一个线程上，这是javascript代码，在主线程上运行，所以当我们等待5000毫秒时候，我们是在主线程上等待，阻止了主线程上的其他活动，这个标准不验证，所以我们要将其改成同时运行这两个步骤。也就是同时执行等待时间和触发回调函数。

换句话说，离开这个线程，同时运行这个任务，但是有了一个新问题，因为现在我们在主线程以外触发回调函数，这行不同，最终会有大量并行运行的Javascript代码，编辑相同的DOM,此时面临残酷的竞争条件，所以我们要做的就是，创建一个任务加到任务队列中，以便在某个时刻回到主线程继续执行。

现在我们在javascript所在的线程上调用Javascript，所以这种方案行得通。这就是浏览器原理的核心部分。

当你单机鼠标，操作系统如何通知Javascript呢？通过向任务队列里加入任务。

请求响应数据如何进入到javascript中呢？通过向任务队列中加入任务

当你从页面发消息到web worker时，同样通过任务队列中加入任务。

任务环中首先关注任务队列，这是任务环的重要内容

当没有任何事件，事件环只是在空转，以节省CPU的方式

事件环

![image-20200526150201827](事件原理讲解.assets/image-20200526150201827.png)



当加入任务时候，事件环会绕道而行

![image-20200526151111620](事件原理讲解.assets/image-20200526151111620.png)

当浏览器将任务提交到事件环时候，事件环会将任务添加到任务队列中，然后执行事件

使用setTimeout将两个callback函数添加到任务队列中，会发生什么？根据之前的分析，可以知道1000毫秒后同步触发callback1和callback2函数，并行每一个等待1000毫秒，然后他们回到主线程，这是通过向任务队列加入任务实现的

![image-20200526151845310](事件原理讲解.assets/image-20200526151845310.png)



![image-20200526151901952](事件原理讲解.assets/image-20200526151901952.png)



![image-20200526151920655](事件原理讲解.assets/image-20200526151920655.png)



![image-20200526151948011](事件原理讲解.assets/image-20200526151948011.png)





![image-20200526152024442](事件原理讲解.assets/image-20200526152024442.png)





考虑渲染的情况

![image-20200526152103666](事件原理讲解.assets/image-20200526152103666.png)



浏览器通过渲染来更新页面显示

![image-20200526152149948](事件原理讲解.assets/image-20200526152149948.png)



![image-20200526152208240](事件原理讲解.assets/image-20200526152208240.png)





![image-20200526152222583](事件原理讲解.assets/image-20200526152222583.png)





![image-20200526152237911](事件原理讲解.assets/image-20200526152237911.png)





![image-20200526152303009](事件原理讲解.assets/image-20200526152303009.png)





![image-20200526152325503](事件原理讲解.assets/image-20200526152325503.png)



![image-20200526152340668](事件原理讲解.assets/image-20200526152340668.png)



![image-20200526152439502](事件原理讲解.assets/image-20200526152439502.png)



![image-20200526152458659](事件原理讲解.assets/image-20200526152458659.png)





![image-20200526152515383](事件原理讲解.assets/image-20200526152515383.png)





![image-20200526152532635](事件原理讲解.assets/image-20200526152532635.png)



![image-20200526152545477](事件原理讲解.assets/image-20200526152545477.png)



![image-20200526152601499](事件原理讲解.assets/image-20200526152601499.png)





![image-20200526152627523](事件原理讲解.assets/image-20200526152627523.png)





![image-20200526152640012](事件原理讲解.assets/image-20200526152640012.png)



![image-20200526152654501](事件原理讲解.assets/image-20200526152654501.png)





![image-20200526152713594](事件原理讲解.assets/image-20200526152713594.png)





![image-20200526152735821](事件原理讲解.assets/image-20200526152735821.png)



![image-20200526152749964](事件原理讲解.assets/image-20200526152749964.png)



![image-20200526152814777](事件原理讲解.assets/image-20200526152814777.png)



![image-20200526152847784](事件原理讲解.assets/image-20200526152847784.png)



![image-20200526152901875](事件原理讲解.assets/image-20200526152901875.png)





![image-20200526152924473](事件原理讲解.assets/image-20200526152924473.png)





![image-20200526153001517](事件原理讲解.assets/image-20200526153001517.png)





![image-20200526153055751](事件原理讲解.assets/image-20200526153055751.png)





![image-20200526153113471](事件原理讲解.assets/image-20200526153113471.png)





![image-20200526153132535](事件原理讲解.assets/image-20200526153132535.png)





![image-20200526153204798](事件原理讲解.assets/image-20200526153204798.png)





![image-20200526153239450](事件原理讲解.assets/image-20200526153239450.png)





![image-20200526153333972](事件原理讲解.assets/image-20200526153333972.png)





![image-20200526153500056](事件原理讲解.assets/image-20200526153500056.png)





![image-20200526153517471](事件原理讲解.assets/image-20200526153517471.png)



![image-20200526153549825](事件原理讲解.assets/image-20200526153549825.png)





![image-20200526153625398](事件原理讲解.assets/image-20200526153625398.png)





![image-20200526153709023](事件原理讲解.assets/image-20200526153709023.png)



![image-20200526153726037](事件原理讲解.assets/image-20200526153726037.png)





![image-20200526153741549](事件原理讲解.assets/image-20200526153741549.png)





![image-20200526153807376](事件原理讲解.assets/image-20200526153807376.png)





![image-20200526153838782](事件原理讲解.assets/image-20200526153838782.png)





![image-20200526153922613](事件原理讲解.assets/image-20200526153922613.png)





![image-20200526153941125](事件原理讲解.assets/image-20200526153941125.png)



![image-20200526154015597](事件原理讲解.assets/image-20200526154015597.png)





![image-20200526154149253](事件原理讲解.assets/image-20200526154149253.png)



![image-20200526154211887](事件原理讲解.assets/image-20200526154211887.png)





